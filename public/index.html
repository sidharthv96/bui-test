<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Helios</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <style>
      @import url("//static.oracle.com/cdn/jet/v8.0.0/default/css/alta/oj-alta-min.css");

      body {
        padding: 20px;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.5/require.min.js"></script>
  </head>
  <body>
    <div id="container">
      <p id="data"></p>
      <h1>Users List</h1>
      <span
        >This demo will not run in Internet Explorer 11 because of the use of
        the HTML5 template element.</span
      >
      <br /><br />

      <!--  
JET UI components are implemented as custom elements following the HTML5 Web Component specification
You interact with them just like any other HTML DOM element.
-->
      <oj-table
        id="table"
        aria-label="Departments Table"
        data="[[dataProvider]]"
        columns-default.sortable="disabled"
        columns='[
                {"headerText": "Employee Number", "field": "empno"},
                {"headerText": "Username", "field": "ename"},
                {"headerText": "Title", "field": "job"},
                {"headerText": "Hire Date", "field": "hiredate", "template": "hireDateTemplate"}, 
                {"headerText": "Salary", "field": "sal", "template": "salTemplate"}
            ]'
      >
        <template slot="cellTemplate" data-oj-as="cell">
          <oj-bind-text value="[[cell.data]]"></oj-bind-text>
        </template>
        <template slot="hireDateTemplate" data-oj-as="cell">
          <oj-bind-text value="[[formatDate(cell.data)]]"></oj-bind-text>
        </template>
        <template slot="salTemplate">
          <oj-bind-text value="[[formatSal($current.data)]]"></oj-bind-text>
        </template>
      </oj-table>

      <!-- 
In this example, inline templates are  being used to customize the look and feel of each rows data.
JET provides built-in validators and converters. as well as the ability to create your own custom versions.
-->
    </div>

    <script>
      /**
RequireJS is used for lazy loading of resources as well as dependency resolution.
**/

      require([
        "knockout",
        "ojs/ojcore",
        "jquery",
        "ojs/ojarraydataprovider",
        "ojs/ojknockout",
        "ojs/ojtable",
        "ojs/ojvalidation-datetime",
        "ojs/ojvalidation-number"
      ], function(ko, oj, $, ArrayDataProvider) {
        "use strict";

        /**
  JET uses a Model-View-ViewModel(MVVM) Architecture.
  **/
        let ViewModel = function() {
          const self = this;

          // for salary fields
          const salOptions = {
            style: "currency",
            currency: "USD"
          };
          const salaryConverter = oj.Validation.converterFactory(
            "number"
          ).createConverter(salOptions);

          // for date fields
          const dateOptions = {
            formatStyle: "date",
            dateFormat: "medium"
          };
          const dateConverter = oj.Validation.converterFactory(
            "datetime"
          ).createConverter(dateOptions);

          // the use of arrow functions works just fine
          self.formatSal = data => salaryConverter.format(data);
          self.formatDate = data => dateConverter.format(data);

          /**
    Data interaction in a JET application is via web services such as REST, WebSockets, or any other
    service that returns JSON data.  You can use jQuery AJAX, as shown below, ES6 fetch(), or XHR methods.  JET also provides a Common Model API that helps with full CRUD type of operations.
    **/
          self.data = ko.observableArray();
          $.getJSON("https://apex.oracle.com/pls/apex/oraclejet/emp/").then(
            users => {
              let tempArray = users.items.map(item => {
                return {
                  empno: item.empno,
                  ename: item.ename,
                  job: item.job,
                  hiredate: item.hiredate,
                  sal: item.sal
                };
              });
              self.data(tempArray);
            }
          );

          self.dataProvider = new ArrayDataProvider(self.data, {
            keyAttributes: "empno"
          });
        };
        ko.applyBindings(new ViewModel(), document.getElementById("container"));
      });

      /**
JET libraries, as well as 3rd party libraries that are distributed as part of JET, are available via a Content Delivery Network(CDN) to help provide the best  performance for your product. 

This also makes upgrading to new releases very quick and easy.
**/

      function _getCDNPath(paths) {
        var cdnPath = "https://static.oracle.com/cdn/jet/";
        var ojPath = "v8.0.0/default/js/";
        var thirdpartyPath = "v8.0.0/3rdparty/";
        var keys = Object.keys(paths);
        var newPaths = {};

        function _isoj(key) {
          return key.indexOf("oj") === 0 && key !== "ojdnd";
        }
        keys.forEach(function(key) {
          newPaths[key] =
            cdnPath + (_isoj(key) ? ojPath : thirdpartyPath) + paths[key];
        });
        return newPaths;
      }

      requirejs.config({
        paths: _getCDNPath({
          knockout: "knockout/knockout-3.5.0",
          jquery: "jquery/jquery-3.4.1.min",
          "jqueryui-amd": "jquery/jqueryui-amd-1.12.1.min",
          promise: "es6-promise/es6-promise.min",
          ojs: "min",
          ojL10n: "ojL10n",
          ojtranslations: "resources",
          signals: "js-signals/signals.min",
          text: "require/text",
          hammerjs: "hammer/hammer-2.0.8.min",
          ojdnd: "dnd-polyfill/dnd-polyfill-1.0.1.min",
          touchr: "touchr/touchr",
          customElements: "webcomponents/custom-elements.min"
        }),
        // Shim configurations for modules that do not expose AMD
        shim: {
          jquery: {
            exports: ["jQuery", "$"]
          }
        }
      });
    </script>
    <script src="https://day486-191101-sql-263h.dq.lan/AgentWeb/module/extensibility/js/client/core/extension_loader.js"></script>
    <script src="main.js"></script>
  </body>
</html>
